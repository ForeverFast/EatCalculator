@using EatCalculator.UI.Entities.Meals.Components
@using EatCalculator.UI.Features.Days
@using EatCalculator.UI.Features.Meals

@inherits BasePageComponent

<div class="@GetCssName(nameof(UpdateDayPage)) inner-main-content @ClassName"
@attributes="@UserAttributes">
    <Condition Evaluation="_currentDay.Value != null">
        <Match>
            <MudContainer Class="border-b rounded-0 px-0">
                <MudToolBar Dense="true"
                            Class="w-100">
                    <MudText Typo="Typo.h5">@_currentDay.Value!.Title</MudText>
                    <MudSpacer />
                    <MudMenu Icon="@Icons.Material.Filled.MoreVert">
                        <MudMenuItem Class="pa-1">
                            <div class="d-flex flex-row align-center">
                                <DeleteDayButton Day="_currentDay.Value!"
                                                 OnClick="OnDeleteDayButtonClick" />
                                <MudText Class="px-1">Удалить</MudText>
                            </div>
                        </MudMenuItem>
                    </MudMenu>
                </MudToolBar>
            </MudContainer>
            <MudContainer Class="mt-4 px-2">
                <MudContainer Class="d-flex flex-column px-0">
                    <MudContainer Class="d-flex flex-row align-center px-0">
                        <MudText>БЖУ в %</MudText>
                        <MudNumericField T="double"
                                         Value="_proteinPercentages"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _proteinPercentages = newValue)"
                                         Label="Б"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input ms-auto me-1" />
                        <MudNumericField T="double"
                                         Value="_fatPercentages"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _fatPercentages = newValue)"
                                         Label="Ж"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input mx-1" />
                        <MudNumericField T="double"
                                         Value="_carbohydratePercentages"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _carbohydratePercentages = newValue)"
                                         Label="У"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input mx-1" />
                    </MudContainer>
                    <MudContainer Class="d-flex flex-row align-center mt-2 px-0">
                        <MudText>Приёмы пищи</MudText>
                        <MudNumericField T="int"
                                         Value="_proteinMealCount"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _proteinMealCount = newValue)"
                                         Label="Б"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input ms-auto me-1" />
                        <MudNumericField T="int"
                                         Value="_fatMealCount"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _fatMealCount = newValue)"
                                         Label="Ж"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input mx-1" />
                        <MudNumericField T="int"
                                         Value="_carbohydrateMealCount"
                                         ValueChanged="newValue => OnChangeDayInfo(() => _carbohydrateMealCount = newValue)"
                                         Label="У"
                                         Min="0" Max="100" HideSpinButtons="true"
                                         Margin="Margin.Dense" Variant="Variant.Outlined"
                                         Class="numeric-input mx-1" />
                    </MudContainer>
                </MudContainer>
                <MudDivider Class="my-4" />
                <MudContainer Class="px-0">
                    <Condition Evaluation="_meals.Value.Count() > 0">
                        <Match>
                            <Iterations Items="@_meals.Value" Context="meal">
                                <MealCard @key="meal" Meal="meal">
                                    <OptionalContent>
                                        <MudPaper Width="100%" Elevation="0"
                                                  Class="d-flex flex-row align-center w-100">
                                            <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                                           Size="Size.Small"
                                                           OnClick="_ => OnEditMealButtonClick(meal)"
                                                           Class="ms-auto" />
                                            <DeleteMealButton Meal="meal" />
                                        </MudPaper>
                                    </OptionalContent>
                                    <BottomContent>
                                        <Condition Evaluation="meal.Portions.Count > 0">
                                            <Match>
                                                <MealPortionsInfo Day="_currentDay.Value"
                                                                  Meal="meal" />
                                            </Match>
                                        </Condition>
                                    </BottomContent>
                                </MealCard>
                            </Iterations>
                        </Match>
                        <NotMatch>
                            <MudText Align="Align.Center">Здесь пока ничего нет</MudText>
                        </NotMatch>
                    </Condition>
                </MudContainer>
            </MudContainer>
        </Match>
    </Condition>
</div>